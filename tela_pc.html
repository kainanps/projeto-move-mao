<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Arrastar com a Mão</title>
<style>
    body {
        margin: 0;
        overflow: hidden;
        background-color: #222;
        font-family: sans-serif;
        user-select: none; /* Impede seleção de texto ao arrastar */
    }

    /* O cursor (sua mão) */
    #cursor {
        position: absolute;
        width: 20px;
        height: 20px;
        background-color: cyan;
        border-radius: 50%;
        border: 2px solid white;
        transform: translate(-50%, -50%);
        pointer-events: none; /* O cursor não interfere no click */
        z-index: 100;
        transition: background-color 0.1s;
    }

    #cursor.fechada {
        background-color: red;
        width: 15px; height: 15px;
    }

    /* O Objeto Arrastável */
    #caixa {
        position: absolute;
        width: 100px;
        height: 100px;
        background-color: #ffcc00;
        top: 50%; left: 50%; /* Começa no meio */
        transform: translate(-50%, -50%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    }
    
    #caixa.arrastando {
        background-color: #ff9900;
        box-shadow: 0 10px 25px rgba(255, 153, 0, 0.6);
        scale: 1.1;
    }
</style>
</head>
<body>

    <div style="color:white; padding:10px">Conecte o celular e use na horizontal</div>
    
    <div id="caixa">ME ARRASTE</div>

    <div id="cursor"></div>

<script>
    const WS_URL = "ws://192.168.0.4:8080"; // IP DO PC

    const cursor = document.getElementById('cursor');
    const caixa = document.getElementById('caixa');

    // Variáveis de estado
    let maoX = 0, maoY = 0;
    let isSegurando = false; // Se a mão está fechada
    let isArrastando = false; // Se está carregando a caixa
    
    // Offset para pegar a caixa pelo ponto certo e não pular para o centro
    let offsetX = 0, offsetY = 0;

    // Posição da caixa
    let caixaX = window.innerWidth / 2;
    let caixaY = window.innerHeight / 2;

    const ws = new WebSocket(WS_URL);

    ws.onmessage = (event) => {
        const data = JSON.parse(event.data);

        // Atualiza posição do cursor (Mão)
        maoX = data.x * window.innerWidth;
        maoY = data.y * window.innerHeight;
        
        isSegurando = (data.estado === "fechada");

        atualizarTela();
    };

    function atualizarTela() {
        // 1. Move o cursor visual
        cursor.style.left = maoX + "px";
        cursor.style.top = maoY + "px";

        if (isSegurando) {
            cursor.classList.add("fechada");
            
            // Lógica de pegar a caixa
            if (!isArrastando) {
                // Checa colisão: A mão está em cima da caixa?
                const rect = caixa.getBoundingClientRect();
                if (maoX > rect.left && maoX < rect.right && 
                    maoY > rect.top && maoY < rect.bottom) {
                    
                    isArrastando = true;
                    // Calcula a diferença para não "teleportar" a caixa pro centro da mão
                    offsetX = maoX - caixaX;
                    offsetY = maoY - caixaY;
                    caixa.classList.add("arrastando");
                }
            }
        } else {
            cursor.classList.remove("fechada");
            // Solta a caixa
            isArrastando = false;
            caixa.classList.remove("arrastando");
        }

        // 2. Se estiver arrastando, move a caixa junto com a mão
        if (isArrastando) {
            caixaX = maoX - offsetX;
            caixaY = maoY - offsetY;
            
            caixa.style.left = caixaX + "px";
            caixa.style.top = caixaY + "px";
            // Remove o transform translate(-50%) pq agora estamos controlando left/top absoluto
            caixa.style.transform = "none"; 
        }
    }
</script>

</body>
</html>