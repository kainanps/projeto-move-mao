<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle Horizontal</title>
<style>
    body { background: black; margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; }
    /* Vídeo ocupa tela toda */
    video { width: 100%; height: 100%; object-fit: cover; } 
</style>
</head>
<body>

<video id="video" autoplay playsinline></video>
<canvas id="canvas" style="display:none;"></canvas>

<script>
    // IMPORTANTE: Use o IP do seu PC
    const PYTHON_API = "http://192.168.0.4:5000/frame"; 

    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    // Configuração para PAISAGEM (Width maior que Height)
    const constraints = { 
        video: { 
            facingMode: 'user',
            width: { ideal: 640 },  // Maior largura
            height: { ideal: 360 }  // Menor altura
        } 
    };

    navigator.mediaDevices.getUserMedia(constraints)
        .then(stream => video.srcObject = stream)
        .catch(err => alert("Erro: " + err));

    setInterval(() => {
        if (video.readyState === video.HAVE_ENOUGH_DATA) {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Qualidade 0.4 para ficar bem leve e rápido
            const image = canvas.toDataURL("image/jpeg", 0.4);

            fetch(PYTHON_API, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ image: image })
            }).catch(e => {}); // Ignora erros de rede para não travar
        }
    }, 33); // 33ms = 30 FPS
</script>
</body>
</html>